{
    #
    # 02phpsettings -- configure virtual hosts to manage php settings
    #

    eval { require esmith::AccountsDB; require esmith::NetworksDB; };
    
    if($@) {
	return '';
    }
	
    # The list of ibays shared among all vhosts:
    @ibays = ();
    
    my $accountsDb = esmith::AccountsDB->open_ro() || return '';
    my $networksDb = esmith::NetworksDB->open_ro() || return '';

    my %adb = $accountsDb->as_hash;


    foreach my $ibayName (sort map {$_->key} $accountsDb->ibays) {

	my %ih = %{$adb{$ibayName}};

	# Skip if web access is not enabled
	if( ! defined $ih{HttpStatus} || $ih{HttpStatus} ne 'enabled') {
	    next;
	}


	my $ibayConf = {
            'AllowUrlfOpen' => $ih{PhpAllowUrlfOpen} || 'enabled',
            'MemoryLimit'=> $ih{PhpMemoryLimit} || 'disabled',
            'UpMaxFileSize'=> $ih{PhpUpMaxFileSize} || 'disabled',
            'PostMaxSize'=> $ih{PhpPostMaxSize} || 'disabled',
            'MaxExecTime'=> $ih{PhpMaxExecTime} || 'disabled',
            'MaxFileUploads'=>$ih{PhpMaxFileUploads} || 'disabled',
	};

	push @ibays, $ibayConf;

    }

}

